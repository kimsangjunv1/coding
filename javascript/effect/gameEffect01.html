<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../assets/css/bg.css">
    <link rel="stylesheet" href="../assets/css/game.css">
    <link rel="stylesheet" href="../assets/css/music.css">


</head>

<body>
    <header id="header">
        <div class="header_cont">
            <img src="../assets/music_img/appleLogo.png" alt="">
            <h1>gamneeffect</h1>
        </div>
        <div class="header_icon_cont" style="display:flex;">
            <img src="../assets/music_img/logo_4k.png" alt="">
            <img src="../assets/music_img/logo_alarm.png" alt="">
            <img src="../assets/music_img/logo_moon.png" alt="">
            <img src="../assets/music_img/logo_cloud.png" alt="">
            <img src="../assets/music_img/logo_sound.png" alt="">
            <img src="../assets/music_img/logo_signal.png" alt="">
            <img src="../assets/music_img/logo_battery.png" alt="">
            <div class="time"></div>
        </div>
    </header>
    <!-- header -->
    <div class="mouse__cursor">
        <!-- <img src="../../assets/img/mouseCursor.png" alt="유지"> -->
    </div>
    <div class="sourceCont">
        <div class="sourceCont_header">
            <p>SOURCE VIEW</p>
            <img src="../assets/music_img/logo_moon.png" alt="">
        </div>
        <iframe class="sourceOpen" src="https://github1s.com/kimsangjunv1/coding/blob/main/javascript/effect/gameEffect01.html" frameborder="0"></iframe>
    </div>
    <main id="main">
        <div class="icon_box">
            <div class="icon1">
                <div class="cont">
                    <img src="../../assets/img/iconGame01.png" alt="유지">
                    <span>게임 01</span>
                </div>
            </div>
            <div class="icon2">
                <div class="cont">
                    <img src="../../assets/img/iconGame02.png" alt="유지">
                    <span>게임 02</span>
                </div>
            </div>
            <div class="icon3">
                <div class="cont">
                    <img src="../../assets/img/iconGame03.png" alt="유지">
                    <span>게임 03</span>
                </div>
            </div>
            <div class="icon4">
                <div class="cont">
                    <img src="../../assets/img/iconGame04.png" alt="유지">
                    <span>뮤직</span>
                </div>
            </div>
            <div class="icon5">
                <div class="cont">
                    <img src="../../assets/img/iconGame05.png" alt="유지">
                    <span>소스 보기</span>
                </div>
            </div>
        </div>
    </main>
    <!-- main -->

    <footer id="footer">
        <div class="agent">1</div>
    </footer>
    <!-- footer -->

    <!-- 뮤직 플레이어 -->
    <div class="music__wrap">
        <div class="music__inner">
            <div class="music__header">
                <img src="../assets/music_img/logo_sound.png" alt="">
                <h2>Music player</h2>
                <div>x</div>
            </div>
            <div class="music__contents">
                <div class="music__view">
                    <div class="img">
                        <img src="../assets/music_img/music_view03.png" alt="">
                        <img class="two" src="../assets/music_img/music_view03.png" alt="">
                    </div>
                    <div class="title">
                        <h3>Average - Patrick Patrikios</h3>
                        <p>youtuber music</p>
                    </div>
                </div>
                <div class="music__control">
                    <div class="progress">
                        <div class="bar">
                            <audio id="main-audio" src="../assets/music/music_audio01.mp3"></audio>
                            <audio id="main-audio" src="../assets/music/music_audio02.mp3"></audio>
                        </div>
                        <div class="timer">
                            <span class="current">0:00</span>
                            <span class="duration">4:00</span>
                        </div>
                    </div>
                    <div class="volumeCont">
                        <input type="range" id="volume-control" min="0" max="10" value="5" step="0.1">							
                    </div> 
                    <div class="control">
                        <i title="전체 반복" class="repeat" id="control-repeat"></i>
                        <i title="이전곡 재생" class="prev" id="control-prev"></i>
                        <i title="재생" class="play" id="control-play"></i>
                        <i title="다음곡 재생" class="next" id="control-next"></i>
                        <i title="재생 목록" class="list" id="control-list"></i>

                        <!-- <i title="한곡 반복" class="repeat_one"></i>-->
                        <!-- <i title="랜덤 반복" class="shuffle"></i> -->
                        <!-- <i title="정지" class="stop"></i> -->
                    </div>
                </div>
            </div>
            <div class="music__footer">
                <div class="music__list">
                    <h3><span class="list"></span>뮤직 리스트 <a href="#" class="close"></a></h3>
                    <ul>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- //뮤직 플레이어 -->

    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="../assets/js/gsap.min.js"></script>
    <script>
        // $( function() {
        //   $( "#draggable" ).draggable();
        // } );
    </script>
    <script>
        $(".icon1").draggable({
            drag: function () {
                $(".mouse__cursor img").attr("src", "../../assets/img/mouseCursor.png")
            },
        });
        $(".icon2").draggable({
            drag: function () {
                $(".mouse__cursor img").attr("src", "../../assets/img/mouseCursor02.png")
            },
        });
        $(".icon3").draggable({
            drag: function () {
                $(".mouse__cursor img").attr("src", "../../assets/img/mouseCursor03.png")
            },
        });
        $(".icon4").draggable({
            drag: function () {
                $(".mouse__cursor img").attr("src", "../../assets/img/mouseCursor04.png")
            },
        });
        $(".icon5").draggable({
            drag: function () {
                $(".mouse__cursor img").attr("src", "../../assets/img/mouseCursor05.png")
            },
        });
        $( ".music__inner" ).draggable();
        $( ".sourceCont" ).draggable();

        //헤더 시계
        function printTime() {
            const clock = document.querySelector(".time");
            const now = new Date();
            const nowTime =now.getFullYear() + "." + (now.getMonth() + 1) + "." + now.getDate() + " ";
            
            
            //진행시간
            let headerHour = Math.floor(now.getHours() % 60);
            let headerMin = Math.floor(now.getMinutes() % 60);
            let headerSec = Math.floor(now.getSeconds() % 60);
            let headerText = "";

            if (headerHour >= 12){ headerText = "오후"} else {headerText = "오전"}
            if (headerHour < 10) headerHour = `0${headerHour}`;
            if (headerMin < 10) headerMin = `0${headerMin}`;
            if (headerSec < 10) headerSec = `0${headerSec}`;

            clock.innerText = nowTime+headerText+` ${headerHour}:${headerMin}:${headerSec}`;

            setTimeout("printTime()", 1000);
        }

        function printAgent() {
            const agent = document.querySelector(".agent");
            const os = navigator.userAgent.toLocaleLowerCase();

            // agent.innerText = os;

            if (os.indexOf("window") == 0) {
                agent.innerText = "현재 윈도우를 사용하고, 화면 크기는 " + screen.width + "x" + screen.height + "입니다.";
                document.querySelector("body").classList.add("window");
            } else if (os.indexOf("macintosh") >= 0) {
                agent.innerText = "현재 맥을 사용중입니다, 화면 크기는 " + screen.width + "x" + screen.height + "입니다.";
                document.querySelector("body").classList.add("mac");
            } else if (os.indexOf("iphone") >= 0) {
                agent.innerText = "현재 아이폰을 사용중입니다, 화면 크기는 " + screen.width + "x" + screen.height + "입니다.";
                document.querySelector("body").classList.add("iphone");
            } else if (os.indexOf("android") >= 0) {
                agent.innerText = "현재 안드로이드를 사용중입니다, 화면 크기는 " + screen.width + "x" + screen.height + "입니다.";
                document.querySelector("body").classList.add("android");
            }
        }

        window.onload = function () {
            printTime();
            printAgent();
        }

        const cursor = document.querySelector(".mouse__cursor");
        window.addEventListener("mousemove",(e) => {
          gsap.to(cursor, {duration: 0.15, left:e.pageX, top:e.pageY});
        });
    </script>
    <script>
        const allMusic = [{
                name: "1. Merry Go Round",
                artist: "hisaishi Joe",
                img: "music_view01",
                audio: "music_audio01"
            },
            {
                name: "2. One Summer's Day",
                artist: "hisaishi Joe",
                img: "music_view02",
                audio: "music_audio02"
            },
            {
                name: "3. Hello Mr's Lawrence",
                artist: "sakamoto ryuichi",
                img: "music_view03",
                audio: "music_audio03"
            },
            {
                name: "4. il porco rosso - By Gone days",
                artist: "hisaishi Joe",
                img: "music_view04",
                audio: "music_audio04"
            },
            {
                name: "5. Ocean Waves",
                artist: "hisaishi Joe",
                img: "music_view05",
                audio: "music_audio05"
            },
            {
                name: "6. American Cliche",
                artist: "Tony Bennetts",
                img: "music_view06",
                audio: "music_audio06"
            },
            {
                name: "7. The Sixth Station",
                artist: "hisaishi Joe",
                img: "music_view07",
                audio: "music_audio07"
            },
            {
                name: "8. In the Balancewith Lyrics",
                artist: "FF14",
                img: "music_view08",
                audio: "music_audio08"
            },
            {
                name: "9. SPOILERS To the Edgewith Lyrics",
                artist: "FF14",
                img: "music_view09",
                audio: "music_audio09"
            },
            {
                name: "10. Suzakus",
                artist: "FF14",
                img: "music_view10",
                audio: "music_audio10"
            }
        ]

        const musicWrap = document.querySelector(".music__wrap");
        const musicView = musicWrap.querySelector(".music__view .img img");
        const musicView2 = musicWrap.querySelector(".music__view .img .two");
        const musicName = musicWrap.querySelector(".music__view .title h3");
        const musicArtist = musicWrap.querySelector(".music__view .title p");
        const musicAudio = musicWrap.querySelector("#main-audio");
        const musicPlay = musicWrap.querySelector("#control-play");
        const musicPrevBtn = musicWrap.querySelector("#control-prev");
        const musicNextBtn = musicWrap.querySelector("#control-next");
        const musicProgress = musicWrap.querySelector(".progress");
        const musicProgressBar = musicWrap.querySelector(".progress .bar");
        const musicProgressCurrent = musicWrap.querySelector(".progress .timer .current");
        const musicProgressDuration = musicWrap.querySelector(".progress .timer .duration");
        const musicRepeat = musicWrap.querySelector("#control-repeat");
        const musicListBtn = musicWrap.querySelector("#control-list");
        const musicList = musicWrap.querySelector(".music__list");
        const musicListUl = musicWrap.querySelector(".music__list ul");

        let musicIndex = 1;
        //음악 재생
        function loadMusic(num) {
            musicName.innerText = allMusic[num - 1].name;                       //뮤직 이름 로드
            musicArtist.innerText = allMusic[num - 1].artist;                   //뮤직 아티스트 로드
            musicView.src = `../assets/music_img/${allMusic[num-1].img}.png`;   //뮤직 이미지 로드
            musicView2.src = `../assets/music_img/${allMusic[num-1].img}.png`;  //뮤직 이미지 alt 로드
            musicView.alt = allMusic[num - 1].name;
            musicAudio.src = `../assets/music/${allMusic[num-1].audio}.mp3`;    //뮤직 로드
        }
        //재생버튼
        function playMusic() {
            musicWrap.classList.add("pause");
            musicPlay.setAttribute("title", "정지");
            musicPlay.setAttribute("class", "stop");
            musicAudio.play();
        }

        //정지버튼
        function pauseMusic() {
            musicWrap.classList.remove("pause");
            musicPlay.setAttribute("title", "재생");
            musicPlay.setAttribute("class", "play");
            musicAudio.pause();
        }

        //이전 곡 듣기 버튼
        function prevMusic() {
            musicIndex == 1 ? musicIndex = allMusic.length : musicIndex--;
            loadMusic(musicIndex);
            playMusic();
            playListMusic();
        }
        //다음 곡 듣기 버튼
        function nextMusic() {
            musicIndex == allMusic.length ? musicIndex = 1 : musicIndex++;
            loadMusic(musicIndex);
            playMusic();
            playListMusic();
        }

        //뮤직 진행바
        musicAudio.addEventListener("timeupdate", e => {

            const currentTime = e.target.currentTime;
            // console.log(currentTime); 시간이 지날 수록 증가(현재 진행되는 시간)

            const duration = e.target.duration;
            // console.log(duration); 전체 갯수(오디오의 총 길이)
            let progressWidth = (currentTime / duration) * 100 //전체 길이에서 현재 진행되는 시간을 백분위로 나눔
            musicProgressBar.style.width = `${progressWidth}%`
            //전체 시간

            musicAudio.addEventListener("loadeddata", () => {
                let audioDuration = musicAudio.duration;
                let totalMin = Math.floor(audioDuration / 60); //전체 시간을 분단위로 쪼개줌
                let totalSec = Math.floor(audioDuration % 60); //남은 초를 저장
                if (totalSec < 10) totalSec = `0${totalSec}`; //초가 한 자릿수일때 앞에 0을 붙임
                musicProgressDuration.textContent = `${totalMin}:${totalSec}`; //완성된 시간 문자열을 출력
            })
            //진행시간
            let currentMin = Math.floor(currentTime / 60);
            let currentSec = Math.floor(currentTime % 60);
            if (currentSec < 10) currentSec = `0${currentSec}`;
            musicProgressCurrent.innerText = `${currentMin}:${currentSec}`;

        })

        //진행버튼 클릭
        musicProgress.addEventListener("click", (e) => {
            let progressWidth = musicProgress.clientWidth; //진행바 전체 길이
            let clickedOffsetx = e.offsetX;                //진행바 기준으로 측정되는 X좌표
            let songDuration = musicAudio.duration;        //오디오 전체 길이

            musicAudio.currentTime = (clickedOffsetx / progressWidth) * songDuration; //백분위로 나눈 숫자에 다시 전체 길이를 곱해서 현재 재생값으로 바꿈
        })

        //반복 버튼 클릭
        musicRepeat.addEventListener("click", ()=>{
            let getAttr = musicRepeat.getAttribute("class");

            switch(getAttr){
                case "repeat" :
                    musicRepeat.setAttribute("class", "repeat_one");
                    musicRepeat.setAttribute("title", "한곡 반복");
                    break;

                case "repeat_one" :
                    musicRepeat.setAttribute("class", "shuffle");
                    musicRepeat.setAttribute("title", "랜덤 반복");
                    break;

                case "shuffle" :
                    musicRepeat.setAttribute("class", "repeat");
                    musicRepeat.setAttribute("title", "전체 반복");
                    break;
            }
        })

        // 오디오가 끝나면
        musicAudio.addEventListener("ended",()=>{
            let getAttr = musicRepeat.getAttribute("class");
            switch(getAttr){
                case "repeat":
                    nextMusic();
                    break;
                case "repeat_one":
                    playMusic();
                    break;
                case "shuffle":
                    let randIndex = Math.floor(Math.random() * allMusic.length + 1); //랜덤 인덱스 생성

                    do{
                        randomIndex = Math.floor(Math.random() * allMusic.length + 1);
                    } while (musicIndex == randomIndex)
                    musicIndex = randomIndex;           //현재 인덱스를 랜덤 인덱스 변경
                    loadMusic(musicIndex);              //랜덤 인덱스가 반영된 현재 인덱스 값으로 음악을 다시 로드
                    playMusic();                        // 로드한 음악을 재생
                    break;


            }
        })

        //플레이 버튼 클릭
        musicPlay.addEventListener("click", () => {
            const isMusicPauesd = musicWrap.classList.contains("pause"); //음악 재생중
            isMusicPauesd ? pauseMusic() : playMusic();
        })

        //이전 버튼 클릭
        musicPrevBtn.addEventListener("click", () => {
            prevMusic();
        })

        musicNextBtn.addEventListener("click", () => {
            nextMusic();
        })

        //뮤직 리스트 버튼
        musicListBtn.addEventListener("click",()=>{
            musicList.classList.add("show")
        })

        // 뮤직 리스트 구현하기
        for(let i=0; i<allMusic.length; i++){
            let li = `
                <li data-index="${i+1}">
                    <strong>${allMusic[i].name}</strong>
                    <em>${allMusic[i].artist}</em>
                    <audio class="${allMusic[i].audio}" src="../assets/music/${allMusic[i].audio}.mp3"></audio>
                    <span class="audio-duration" id="${allMusic[i].audio}">재생시간</span>
                </li>
            `;

            // musicListUl.innerHTML += li;
            musicListUl.insertAdjacentHTML("beforeend", li);

            
            // 리스트에 음악 시간 불러오기
            let liAudioDuration = musicListUl.querySelector(`#${allMusic[i].audio}`);     //리스트에서 시간을 표시할 선택자를 가져옴
            let liAudio = musicListUl.querySelector(`.${allMusic[i].audio}`);             //리스트에서 오디오를 가져옴
            liAudio.addEventListener("loadeddata", ()=>{
                let audioDuration = liAudio.duration;                                      //오디오 전체 길이
                let totalMin = Math.floor(audioDuration / 60);                             //전체 길이르리 분 단위 쪼갬
                let totalSec = Math.floor(audioDuration % 60);                             //초 계산
                if(totalSec < 10) totalSec = `0${totalSec}`;                              //앞 자리에 0 추가
                liAudioDuration.innerText = `${totalMin}:${totalSec}`;                    //문자열 출력
                liAudioDuration.setAttribute("data-duration", `${totalMin}:${totalSec}`); //속성의 오디오 길이 기록
                
            })
        }

        // 뮤직 리스트를 클릭하면 재생
        function playListMusic(){
            const musicListAll = musicListUl.querySelectorAll("li");
            for(let i = 0; i < musicListAll.length; i++){
                let audioTag = musicListAll[i].querySelector(".audio-duration");

                if(musicListAll[i].classList.contains("playing")){               //클래스에 playing 클래스가 포함되어 있다면
                    musicListAll[i].classList.remove("playing");                 //Playing 클래스 삭제
                    let adDuration = audioTag.getAttribute("data-duration");     //오디오 길이 값 가져오기
                    audioTag.innerText = adDuration;                             //오디오 길이 값 추가
                }

                if(musicListAll[i].getAttribute("data-index")==musicIndex){      //현재 뮤직인덱스랑 리스트 인덱스 값이 같으면
                    musicListAll[i].classList.add("playing");                    //클래스 playing 추가
                    audioTag.innerText = "재생중";                                 //재생중일 경우 재생중 멘트 추가
                }

                musicListAll[i].setAttribute("onclick", "clicked(this)");
            }
        }
        // playListMusic();

        //뮤직 리스트를 클릭하면..
        function clicked(el){
            let getLiIndex = el.getAttribute("data-index");              // 클릭한 데이터 값
            musicIndex = getLiIndex;                                     // 클릭한 인덱스 값을 뮤직 인덱스에 저장
            loadMusic(musicIndex);                                       // 해당 인덱스 뮤직 로드
            playMusic();                                                // 음악 재생
            playListMusic();                                             // 음악 리스트 업데이트
        }

        window.addEventListener("load", () => {
            loadMusic(musicIndex);      //음악 재생
            playListMusic();            //리스트 초기화
        })
    </script>

    <script>
        const a = document.querySelector(".music__list .close")
        const beee = document.querySelector(".music__list")
        const c = document.querySelector("#control-list");

        c.addEventListener("click", ()=>{
            beee.style.display="block";
        });

        a.addEventListener("click", ()=>{
            beee.style.display="none";
        });
    </script>

    <script>
        const sourceIcon = document.querySelector(".icon5")
        const sourceOpen = document.querySelector(".sourceCont")
        const sourceClose = document.querySelector(".sourceCont_header img")

        sourceIcon.addEventListener("click", ()=>{
            sourceOpen.style.display="block";
        });
        sourceClose.addEventListener("click", ()=>{
            sourceOpen.style.display="none";
        })
    </script>
    <script>
        const audioIcon = document.querySelector(".music__header img")
        let i=0;
        audioIcon.addEventListener("click",()=>{
            if(i==0){
                // document.querySelector(".volumeCont").style.display="block";
                document.querySelector(".volumeCont").style.transform="translate(-50%, 0)";
                audioIcon.style.transform="translatex(88px)";
                i++;
            } else{
                // document.querySelector(".volumeCont").style.display="none";
                document.querySelector(".volumeCont").style.transform="translate(-50%, -100px)";
                audioIcon.style.transform="translatex(0)";
                i--;
            }
        })

        const audio = document.getElementById('main-audio');
        const audioVolume = document.getElementById('volume-control');

        audioVolume.addEventListener("change", function(e) {
            audio.volume = this.value/10;
        })

        //뮤직플레이어 닫기
        const musicPlayerClose = document.querySelector(".music__header div");
        const musicPlayer = document.querySelector(".music__wrap");
        const musicIcon = document.querySelector(".icon4")

        musicPlayerClose.addEventListener("click", ()=>{
            musicPlayer.style.display="none";
        })
        musicIcon.addEventListener("click",()=>{
            musicPlayer.style.display="block";
        })
    </script>

</body>

</html>